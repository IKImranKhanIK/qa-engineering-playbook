<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Progress - QA Engineering Playbook</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3b82f6">
    <link rel="stylesheet" href="styles.css?v=2.6">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <div id="nav-placeholder"></div>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1>Your Learning Progress</h1>
            <p>Track your journey through the QA Engineering Playbook</p>
        </div>
    </section>

    <!-- Progress Content -->
    <section class="content-section">
        <div class="container" style="max-width: 1000px;">

            <!-- Overall Stats -->
            <div class="progress-stats-grid">
                <div class="progress-stat-card">
                    <div class="stat-icon">üìö</div>
                    <h3>Modules Completed</h3>
                    <div class="stat-number" id="modulesCompleted">0</div>
                    <div class="stat-total">out of <span id="totalModules">11</span></div>
                    <div class="progress-bar" style="margin-top: 1rem;">
                        <div class="progress-fill" id="moduleProgress" style="width: 0%"></div>
                    </div>
                    <div class="stat-percentage" id="modulePercentage">0%</div>
                </div>

                <div class="progress-stat-card">
                    <div class="stat-icon">üìñ</div>
                    <h3>Lessons Completed</h3>
                    <div class="stat-number" id="lessonsCompleted">0</div>
                    <div class="stat-total">out of <span id="totalLessons">48</span></div>
                    <div class="progress-bar" style="margin-top: 1rem;">
                        <div class="progress-fill" id="lessonProgress" style="width: 0%"></div>
                    </div>
                    <div class="stat-percentage" id="lessonPercentage">0%</div>
                </div>

                <div class="progress-stat-card">
                    <div class="stat-icon">üß™</div>
                    <h3>Labs Completed</h3>
                    <div class="stat-number" id="labsCompleted">0</div>
                    <div class="stat-total">out of <span id="totalLabs">10</span></div>
                    <div class="progress-bar" style="margin-top: 1rem;">
                        <div class="progress-fill" id="labProgress" style="width: 0%"></div>
                    </div>
                    <div class="stat-percentage" id="labPercentage">0%</div>
                </div>

                <div class="progress-stat-card">
                    <div class="stat-icon">üî•</div>
                    <h3>Learning Streak</h3>
                    <div class="stat-number" id="currentStreak">0</div>
                    <div class="stat-total">days</div>
                    <div style="margin-top: 1rem; color: var(--gray); font-size: 0.9rem;">
                        Longest: <span id="longestStreak">0</span> days
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-section">
                <div class="chart-card">
                    <h3>Module Progress Chart</h3>
                    <canvas id="moduleChart" width="400" height="200"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Activity Timeline</h3>
                    <div id="activityTimeline"></div>
                </div>
            </div>

            <!-- Module-by-Module Progress -->
            <div class="progress-detail-section">
                <h2>Module Progress</h2>
                <div id="moduleProgressDetail"></div>
            </div>

            <!-- Recent Activity -->
            <div class="progress-detail-section">
                <h2>Recent Activity</h2>
                <div id="recentActivity">
                    <p style="color: var(--gray); text-align: center; padding: 2rem;">
                        Complete lessons to see your activity here
                    </p>
                </div>
            </div>

            <!-- Certificates Section -->
            <div class="progress-detail-section">
                <h2>üèÜ Certificates</h2>
                <div id="certificatesSection"></div>
            </div>

            <!-- Data Management -->
            <div style="text-align: center; margin-top: 3rem; padding-top: 2rem; border-top: 2px solid var(--gray-light);">
                <h3 style="margin-bottom: 1.5rem; color: var(--dark);">Data Management</h3>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="exportProgress()">üì• Export Progress</button>
                    <button class="btn btn-primary" onclick="document.getElementById('importFile').click()">üì§ Import Progress</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importProgress(event)">
                    <button class="btn btn-outline" onclick="resetProgress()">üóëÔ∏è Reset All Progress</button>
                </div>
                <p style="margin-top: 1rem; color: var(--gray); font-size: 0.9rem;">
                    Export your progress to backup or transfer to another device
                </p>
            </div>

        </div>
    </section>

    <script src="nav.js"></script>
    <script src="app.js?v=2.6"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            displayProgress();
        });

        function displayProgress() {
            // Calculate overall stats
            const totalModules = modules.length;
            const completedModules = Object.values(progress.modules).filter(count => count > 0).length;
            const modulePercent = (completedModules / totalModules) * 100;

            const totalLessons = modules.reduce((sum, m) => sum + m.lessons, 0);
            const completedLessons = Object.values(progress.lessons).filter(Boolean).length;
            const lessonPercent = (completedLessons / totalLessons) * 100;

            const totalLabs = labs.length;
            const completedLabs = Object.values(progress.labs).filter(Boolean).length;
            const labPercent = (completedLabs / totalLabs) * 100;

            // Update overall stats
            document.getElementById('modulesCompleted').textContent = completedModules;
            document.getElementById('totalModules').textContent = totalModules;
            document.getElementById('moduleProgress').style.width = modulePercent + '%';
            document.getElementById('modulePercentage').textContent = Math.round(modulePercent) + '%';

            document.getElementById('lessonsCompleted').textContent = completedLessons;
            document.getElementById('totalLessons').textContent = totalLessons;
            document.getElementById('lessonProgress').style.width = lessonPercent + '%';
            document.getElementById('lessonPercentage').textContent = Math.round(lessonPercent) + '%';

            document.getElementById('labsCompleted').textContent = completedLabs;
            document.getElementById('totalLabs').textContent = totalLabs;
            document.getElementById('labProgress').style.width = labPercent + '%';
            document.getElementById('labPercentage').textContent = Math.round(labPercent) + '%';

            // Calculate and display streak
            calculateStreak();

            // Display module-by-module progress
            displayModuleProgress();

            // Display charts
            displayModuleChart();
            displayActivityTimeline();

            // Display certificates
            displayCertificatesSection();
        }

        function calculateStreak() {
            const completionDates = progress.completionDates || [];
            if (completionDates.length === 0) {
                document.getElementById('currentStreak').textContent = '0';
                document.getElementById('longestStreak').textContent = '0';
                return;
            }

            // Sort dates
            const sortedDates = completionDates.map(d => new Date(d)).sort((a, b) => b - a);

            let currentStreak = 1;
            let longestStreak = 1;
            let tempStreak = 1;

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Check if last completion was today or yesterday
            const lastDate = new Date(sortedDates[0]);
            lastDate.setHours(0, 0, 0, 0);
            const daysDiff = Math.floor((today - lastDate) / (1000 * 60 * 60 * 24));

            if (daysDiff > 1) {
                currentStreak = 0;
            }

            // Calculate streaks
            for (let i = 1; i < sortedDates.length; i++) {
                const date1 = new Date(sortedDates[i - 1]);
                const date2 = new Date(sortedDates[i]);
                date1.setHours(0, 0, 0, 0);
                date2.setHours(0, 0, 0, 0);

                const diff = Math.floor((date1 - date2) / (1000 * 60 * 60 * 24));

                if (diff === 1) {
                    tempStreak++;
                    if (i === sortedDates.length - 1 || daysDiff <= 1) {
                        currentStreak = tempStreak;
                    }
                } else {
                    longestStreak = Math.max(longestStreak, tempStreak);
                    tempStreak = 1;
                }
            }

            longestStreak = Math.max(longestStreak, tempStreak, currentStreak);

            document.getElementById('currentStreak').textContent = currentStreak;
            document.getElementById('longestStreak').textContent = longestStreak;
        }

        function displayModuleChart() {
            const canvas = document.getElementById('moduleChart');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // Check for dark mode
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const textColor = isDark ? '#e5e7eb' : '#374151';

            // Clear canvas
            ctx.clearRect(0, 0, width, height);

            // Draw bar chart
            const barWidth = width / modules.length - 10;
            const maxHeight = height - 40;

            modules.forEach((module, index) => {
                const completed = progress.modules[module.id] || 0;
                const percent = (completed / module.lessons) * 100;
                const barHeight = (percent / 100) * maxHeight;

                const x = index * (barWidth + 10) + 5;
                const y = height - barHeight - 20;

                // Draw bar
                const gradient = ctx.createLinearGradient(0, y, 0, height);
                gradient.addColorStop(0, '#6366f1');
                gradient.addColorStop(1, '#8b5cf6');

                ctx.fillStyle = gradient;
                ctx.fillRect(x, y, barWidth, barHeight);

                // Draw percentage
                ctx.fillStyle = textColor;
                ctx.font = '10px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(Math.round(percent) + '%', x + barWidth / 2, y - 5);

                // Draw module number
                ctx.fillText('M' + (index + 1), x + barWidth / 2, height - 5);
            });
        }

        function displayActivityTimeline() {
            const timeline = document.getElementById('activityTimeline');
            const completionDates = progress.completionDates || [];

            if (completionDates.length === 0) {
                timeline.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 2rem;">No activity yet. Start learning to see your timeline!</p>';
                return;
            }

            // Group by date
            const dateGroups = {};
            completionDates.forEach(dateStr => {
                const date = new Date(dateStr).toLocaleDateString();
                dateGroups[date] = (dateGroups[date] || 0) + 1;
            });

            // Create timeline
            let html = '<div class="timeline">';
            Object.entries(dateGroups).reverse().slice(0, 10).forEach(([date, count]) => {
                html += `
                    <div class="timeline-item">
                        <div class="timeline-date">${date}</div>
                        <div class="timeline-content">${count} lesson${count > 1 ? 's' : ''} completed</div>
                    </div>
                `;
            });
            html += '</div>';

            timeline.innerHTML = html;
        }

        function displayModuleProgress() {
            const container = document.getElementById('moduleProgressDetail');
            container.innerHTML = '';

            modules.forEach(module => {
                const completed = progress.modules[module.id] || 0;
                const percent = (completed / module.lessons) * 100;

                const moduleCard = document.createElement('div');
                moduleCard.className = 'module-progress-card';
                moduleCard.innerHTML = `
                    <div class="module-progress-header">
                        <h3>${module.title}</h3>
                        <span class="module-progress-count">${completed} / ${module.lessons} lessons</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percent}%"></div>
                    </div>
                    <a href="module.html?id=${module.id}" class="btn btn-outline btn-small" style="margin-top: 1rem;">
                        ${completed === 0 ? 'Start Module' : completed === module.lessons ? 'Review Module' : 'Continue Learning'}
                    </a>
                `;

                container.appendChild(moduleCard);
            });
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset all your progress? This cannot be undone.')) {
                localStorage.removeItem('qaPlaybookProgress');
                location.reload();
            }
        }

        function exportProgress() {
            const data = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                progress: progress
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `qa-playbook-progress-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('‚úÖ Progress exported successfully!');
        }

        function importProgress(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);

                    if (!data.progress) {
                        throw new Error('Invalid progress file format');
                    }

                    if (confirm('This will replace your current progress. Continue?')) {
                        localStorage.setItem('qaPlaybookProgress', JSON.stringify(data.progress));
                        alert('‚úÖ Progress imported successfully!');
                        location.reload();
                    }
                } catch (error) {
                    alert('‚ùå Error importing progress: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function displayCertificatesSection() {
            const certificatesDiv = document.getElementById('certificatesSection');

            // Calculate available certificates
            const completedModules = modules.filter(module => {
                const completed = progress.modules[module.id] || 0;
                return completed === module.lessons;
            });

            const totalModules = modules.length;
            const availableCertificates = completedModules.length;
            const courseComplete = completedModules.length === totalModules;

            certificatesDiv.innerHTML = `
                <div class="certificate-summary">
                    <div class="certificate-summary-card">
                        <div class="certificate-icon">üèÜ</div>
                        <div>
                            <h3>Available Certificates</h3>
                            <div class="certificate-count">
                                <span class="big-number">${availableCertificates + (courseComplete ? 1 : 0)}</span>
                                <span class="certificate-label">ready to claim</span>
                            </div>
                        </div>
                    </div>

                    <div class="certificate-info-card">
                        <p><strong>Module Certificates:</strong> ${availableCertificates} of ${totalModules} available</p>
                        <p><strong>Course Certificate:</strong> ${courseComplete ? '‚úÖ Available!' : `‚è≥ Complete ${totalModules - availableCertificates} more module(s)`}</p>
                        <a href="certificates.html" class="btn btn-primary" style="margin-top: 1rem;">
                            View & Generate Certificates ‚Üí
                        </a>
                    </div>
                </div>

                ${availableCertificates > 0 || courseComplete ? `
                    <div class="certificate-list-preview">
                        <h4>Ready to Claim:</h4>
                        <ul>
                            ${courseComplete ? '<li>üèÜ <strong>Course Completion Certificate</strong> - All modules completed!</li>' : ''}
                            ${completedModules.slice(0, 5).map(module =>
                                `<li>üìú <strong>${module.title}</strong> - Module certificate</li>`
                            ).join('')}
                            ${completedModules.length > 5 ? `<li style="color: var(--gray);">...and ${completedModules.length - 5} more</li>` : ''}
                        </ul>
                    </div>
                ` : `
                    <div style="text-align: center; padding: 2rem; color: var(--gray);">
                        <p>Complete modules to unlock certificates and showcase your achievements!</p>
                    </div>
                `}
            `;
        }
    </script>
</body>
</html>
